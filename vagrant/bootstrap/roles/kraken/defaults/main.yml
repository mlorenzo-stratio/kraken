---
# kraken global variables
kraken_repo_root: "{{ playbook_dir }}/../.."
kraken_herd_hosts: "{{ groups['herd'] | map('extract', hostvars, ['ansible_fqdn']) | list }}"
kraken_config_dir: /etc/kraken
kraken_binary_dir: /usr/local/bin
kraken_log_dir: /var/log/kraken
kraken_cache_dir: /var/cache/kraken
kraken_socket_dir: /run/kraken

# kraken services ports
kraken_agent_registry_port: 32001
kraken_agent_peer_port: 32004
kraken_agent_server_port: 32003
kraken_redis_port: 32001
kraken_origin_peer_port: 32002
kraken_origin_server_port: 32003
kraken_tracker_port: 32004
kraken_build_index_port: 32005


# kraken-agent
kraken_agent_socket: "{{ kraken_socket_dir }}/kraken-agent.sock"
kraken_agent_folders:
  nginx_dir:
    path: /var/cache/nginx
    owner: kraken
    mode: "0755"
  nginx_log_dir:
    path: /var/log/nginx
    owner: kraken
    mode: "0755"
  nginx_lib:
    path: /var/lib/nginx/
    owner: kraken
    mode: "0755"
  nginx_lib_tmp:
    path: /var/lib/nginx/tmp
    owner: kraken
    mode: "0755"
  nginx_run:
    path: /var/run/nginx/
    owner: kraken
    mode: "0755"
  nginx_config:
    path: "{{ kraken_config_dir }}/nginx/config"
    owner: kraken
    mode: "0755"
  tls:
    path: "{{ kraken_config_dir }}/tls"
    owner: kraken
    mode: "0755"
  log:
    path: "{{ kraken_log_dir }}"
    owner: kraken
    mode: "0755"
  nginx_cache:
    path: "{{ kraken_cache_dir }}/nginx"
    owner: kraken
    mode: "0755"
  agent_cache:
    path: "{{ kraken_cache_dir }}/cache"
    owner: kraken
    mode: "0755"
  agent_download:
    path: "{{ kraken_cache_dir }}/download"
    owner: kraken
    mode: "0755"


# redis for redis
kraken_redis_folders:
  config:
    path: "{{ kraken_config_dir }}"
    owner: kraken-redis
    mode: "0755"
  cache:
    path: "{{ kraken_cache_dir }}/kraken-redis"
    owner: kraken-redis
    mode: "0755"


# kraken-origin
kraken_origin_socket: "{{ kraken_socket_dir }}/kraken-origin.sock"
kraken_origin_folders:
  nginx_dir:
    path: /var/cache/nginx
    owner: root
    mode: "0775"
  nginx_log_dir:
    path: /var/log/nginx
    owner: root
    mode: "0775"
  nginx_lib:
    path: /var/lib/nginx/
    owner: root
    mode: "0775"
  nginx_lib_tmp:
    path: /var/lib/nginx/tmp
    owner: root
    mode: "0775"
  nginx_run:
    path: /var/run/nginx/
    owner: root
    mode: "0775"
  nginx_config:
    path: "{{ kraken_config_dir }}/nginx/config"
    owner: root
    mode: "0775"
  tls:
    path: "{{ kraken_config_dir }}/tls-origin"
    owner: kraken
    mode: "0755"
  log:
    path: "{{ kraken_log_dir }}"
    owner: root
    mode: "0775"
  kraken_origin_cache:
    path: "{{ kraken_cache_dir }}/kraken-origin"
    owner: kraken
    mode: "0755"
  nginx_cache:
    path: "{{ kraken_cache_dir }}/kraken-origin/nginx"
    owner: kraken
    mode: "0755"
  origin_cache:
    path: "{{ kraken_cache_dir }}/kraken-origin/cache"
    owner: kraken
    mode: "0755"
  origin_upload:
    path: "{{ kraken_cache_dir }}/kraken-origin/upload"
    owner: kraken
    mode: "0775"


# kraken-tracker
kraken_tracker_socket: "{{ kraken_socket_dir }}/kraken-tracker.sock"
kraken_tracker_folders:
  nginx_dir:
    path: /var/cache/nginx
    owner: root
    mode: "0775"
  nginx_log_dir:
    path: /var/log/nginx
    owner: root
    mode: "0775"
  nginx_lib:
    path: /var/lib/nginx/
    owner: root
    mode: "0775"
  nginx_lib_tmp:
    path: /var/lib/nginx/tmp
    owner: root
    mode: "0775"
  nginx_run:
    path: /var/run/nginx/
    owner: root
    mode: "0775"
  nginx_config:
    path: "{{ kraken_config_dir }}/nginx/config"
    owner: root
    mode: "0775"
  tls:
    path: "{{ kraken_config_dir }}/tls-tracker"
    owner: kraken
    mode: "0755"
  log:
    path: "{{ kraken_log_dir }}"
    owner: root
    mode: "0775"
  kraken_tracker_cache:
    path: "{{ kraken_cache_dir }}/kraken-tracker"
    owner: kraken
    mode: "0755"
  nginx_cache:
    path: "{{ kraken_cache_dir }}/kraken-tracker/nginx"
    owner: kraken
    mode: "0755"


# kraken-build-index
kraken_build_index_socket: "{{ kraken_socket_dir }}/kraken-build-index.sock"
kraken_build_index_folders:
  nginx_dir:
    path: /var/cache/nginx
    owner: root
    mode: "0775"
  nginx_log_dir:
    path: /var/log/nginx
    owner: root
    mode: "0775"
  nginx_lib:
    path: /var/lib/nginx/
    owner: root
    mode: "0775"
  nginx_lib_tmp:
    path: /var/lib/nginx/tmp
    owner: root
    mode: "0775"
  nginx_run:
    path: /var/run/nginx/
    owner: root
    mode: "0775"
  nginx_config:
    path: "{{ kraken_config_dir }}/nginx/config"
    owner: root
    mode: "0775"
  tls:
    path: "{{ kraken_config_dir }}/tls-build-index"
    owner: kraken
    mode: "0755"
  log:
    path: "{{ kraken_log_dir }}"
    owner: root
    mode: "0775"
  kraken_build_index_cache:
    path: "{{ kraken_cache_dir }}/kraken-build-index"
    owner: kraken
    mode: "0755"
  nginx_cache:
    path: "{{ kraken_cache_dir }}/kraken-build-index/nginx"
    owner: kraken
    mode: "0755"
  build_index_cache:
    path: "{{ kraken_cache_dir }}/kraken-build-index/cache"
    owner: kraken
    mode: "0755"
  build_index_upload:
    path: "{{ kraken_cache_dir }}/kraken-build-index/upload"
    owner: kraken
    mode: "0775"


# Kraken services configuration dictionaries:
binary_files:
  kraken_redis:
    redis_binaries:
      src: "{{ kraken_repo_root }}/redis/bin/"
      dest: "{{ kraken_binary_dir }}"
  kraken_agent:
    kraken_agent_binary:
      src: "{{ kraken_repo_root }}/bin/agent"
      dest: "{{ kraken_binary_dir }}/kraken-agent"
  kraken_origin:
    kraken_origin_binary:
      src: "{{ kraken_repo_root }}/bin/origin"
      dest: "{{ kraken_binary_dir }}/kraken-origin"
  kraken_tracker:
    kraken_tracker_binary:
      src: "{{ kraken_repo_root }}/bin/tracker"
      dest: "{{ kraken_binary_dir }}/kraken-tracker"
  kraken_build_index:
    kraken_build_index_binary:
      src: "{{ kraken_repo_root }}/bin/build-index"
      dest: "{{ kraken_binary_dir }}/kraken-build-index"

config_files:
  kraken_redis:
    config:
      src: kraken-redis.conf.j2
      dest: "{{ kraken_config_dir }}/kraken-redis.conf"
    systemd:
      src: kraken-redis.service.j2
      dest: /etc/systemd/system/kraken-redis.service
  kraken_agent_templates:
    base:
      src: kraken-agent_base.yaml.j2
      dest: "{{ kraken_config_dir }}/base.yaml"
    config:
      src: kraken-agent.yaml.j2
      dest: "{{ kraken_config_dir }}/kraken-agent.yaml"
    systemd:
      src: kraken-agent.service.j2
      dest: /etc/systemd/system/kraken-agent.service
  kraken_agent_files:
    nginx_config:
      src: "{{ kraken_repo_root }}/nginx/config/"
      dest: "{{ kraken_config_dir }}/nginx/config/"
  kraken_origin_templates:
    base:
      src: kraken-origin_base.yaml.j2
      dest: "{{ kraken_config_dir }}/kraken-origin_base.yaml"
    config:
      src: kraken-origin.yaml.j2
      dest: "{{ kraken_config_dir }}/kraken-origin.yaml"
    systemd:
      src: kraken-origin.service.j2
      dest: /etc/systemd/system/kraken-origin.service
  kraken_origin_files:
    nginx_config:
      src: "{{ kraken_repo_root }}/nginx/config/"
      dest: "{{ kraken_config_dir }}/nginx/config/"
  kraken_tracker_templates:
    base:
      src: kraken-tracker_base.yaml.j2
      dest: "{{ kraken_config_dir }}/kraken-tracker_base.yaml"
    config:
      src: kraken-tracker.yaml.j2
      dest: "{{ kraken_config_dir }}/kraken-tracker.yaml"
    systemd:
      src: kraken-tracker.service.j2
      dest: /etc/systemd/system/kraken-tracker.service
  kraken_tracker_files:
    nginx_config:
      src: "{{ kraken_repo_root }}/nginx/config/"
      dest: "{{ kraken_config_dir }}/nginx/config/"
  kraken_build_index_templates:
    base:
      src: kraken-build-index_base.yaml.j2
      dest: "{{ kraken_config_dir }}/kraken-build-index_base.yaml"
    config:
      src: kraken-build-index.yaml.j2
      dest: "{{ kraken_config_dir }}/kraken-build-index.yaml"
    systemd:
      src: kraken-build-index.service.j2
      dest: /etc/systemd/system/kraken-build-index.service
  kraken_build_index_files:
    nginx_config:
      src: "{{ kraken_repo_root }}/nginx/config/"
      dest: "{{ kraken_config_dir }}/nginx/config/"

# tls_certificates:
#   kraken_agent:
#     server_crt:
#       src: "{{ ansible_fqdn }}_server.pem"
#       dest: "{{ kraken_config_dir }}/tls/server.crt"
#     server_key:
#       src: "{{ ansible_fqdn }}_server.key"
#       dest: "{{ kraken_config_dir }}/tls/server.key"
#     client_crt:
#       src: "{{ ansible_fqdn }}_client.crt"
#       dest: "{{ kraken_config_dir }}/tls/client.crt"
#     client_key:
#       src: "{{ ansible_fqdn }}_client.key"
#       dest: "{{ kraken_config_dir }}/tls/client.key"
#   kraken_origin:
#     server_crt:
#       src: "{{ ansible_fqdn }}_server.pem"
#       dest: "{{ kraken_config_dir }}/tls-origin/server.crt"
#     server_key:
#       src: "{{ ansible_fqdn }}_server.key"
#       dest: "{{ kraken_config_dir }}/tls-origin/server.key"
#     client_crt:
#       src: "{{ ansible_fqdn }}_client.crt"
#       dest: "{{ kraken_config_dir }}/tls-origin/client.crt"
#     client_key:
#       src: "{{ ansible_fqdn }}_client.key"
#       dest: "{{ kraken_config_dir }}/tls-origin/client.key"
#   kraken_tracker:
#     server_crt:
#       src: "{{ ansible_fqdn }}_server.pem"
#       dest: "{{ kraken_config_dir }}/tls-tracker/server.crt"
#     server_key:
#       src: "{{ ansible_fqdn }}_server.key"
#       dest: "{{ kraken_config_dir }}/tls-tracker/server.key"
#     client_crt:
#       src: "{{ ansible_fqdn }}_client.crt"
#       dest: "{{ kraken_config_dir }}/tls-tracker/client.crt"
#     client_key:
#       src: "{{ ansible_fqdn }}_client.key"
#       dest: "{{ kraken_config_dir }}/tls-tracker/client.key"
#   kraken_build_index:
#     server_crt:
#       src: "{{ ansible_fqdn }}_server.pem"
#       dest: "{{ kraken_config_dir }}/tls-build-index/server.crt"
#     server_key:
#       src: "{{ ansible_fqdn }}_server.key"
#       dest: "{{ kraken_config_dir }}/tls-build-index/server.key"
#     client_crt:
#       src: "{{ ansible_fqdn }}_client.crt"
#       dest: "{{ kraken_config_dir }}/tls-build-index/client.crt"
#     client_key:
#       src: "{{ ansible_fqdn }}_client.key"
#       dest: "{{ kraken_config_dir }}/tls-build-index/client.key"

tls_certificates:
  kraken_agent:
    server_crt:
      src: "{{ kraken_repo_root }}/test/tls/ca/server.crt"
      dest: "{{ kraken_config_dir }}/tls/server.crt"
    server_key:
      src: "{{ kraken_repo_root }}/test/tls/ca/server.key"
      dest: "{{ kraken_config_dir }}/tls/server.key"
    server_passphrase:
      src: "{{ kraken_repo_root }}/test/tls/ca/passphrase"
      dest: "{{ kraken_config_dir }}/tls/server.passphrase"
    client_crt:
      src: "{{ kraken_repo_root }}/test/tls/client/client.crt"
      dest: "{{ kraken_config_dir }}/tls/client.crt"
    client_key:
      src: "{{ kraken_repo_root }}/test/tls/client/client.key"
      dest: "{{ kraken_config_dir }}/tls/client.key"
    client_passphrase:
      src: "{{ kraken_repo_root }}/test/tls/client/passphrase"
      dest: "{{ kraken_config_dir }}/tls/client.passphrase"
  kraken_origin:
    server_crt:
      src: "{{ kraken_repo_root }}/test/tls/ca/server.crt"
      dest: "{{ kraken_config_dir }}/tls-origin/server.crt"
    server_key:
      src: "{{ kraken_repo_root }}/test/tls/ca/server.key"
      dest: "{{ kraken_config_dir }}/tls-origin/server.key"
    server_passphrase:
      src: "{{ kraken_repo_root }}/test/tls/ca/passphrase"
      dest: "{{ kraken_config_dir }}/tls-origin/server.passphrase"
    client_crt:
      src: "{{ kraken_repo_root }}/test/tls/client/client.crt"
      dest: "{{ kraken_config_dir }}/tls-origin/client.crt"
    client_key:
      src: "{{ kraken_repo_root }}/test/tls/client/client.key"
      dest: "{{ kraken_config_dir }}/tls-origin/client.key"
    client_passphrase:
      src: "{{ kraken_repo_root }}/test/tls/client/passphrase"
      dest: "{{ kraken_config_dir }}/tls-origin/client.passphrase"
  kraken_tracker:
    server_crt:
      src: "{{ kraken_repo_root }}/test/tls/ca/server.crt"
      dest: "{{ kraken_config_dir }}/tls-tracker/server.crt"
    server_key:
      src: "{{ kraken_repo_root }}/test/tls/ca/server.key"
      dest: "{{ kraken_config_dir }}/tls-tracker/server.key"
    server_passphrase:
      src: "{{ kraken_repo_root }}/test/tls/ca/passphrase"
      dest: "{{ kraken_config_dir }}/tls-tracker/server.passphrase"
    client_crt:
      src: "{{ kraken_repo_root }}/test/tls/client/client.crt"
      dest: "{{ kraken_config_dir }}/tls-tracker/client.crt"
    client_key:
      src: "{{ kraken_repo_root }}/test/tls/client/client.key"
      dest: "{{ kraken_config_dir }}/tls-tracker/client.key"
    client_passphrase:
      src: "{{ kraken_repo_root }}/test/tls/client/passphrase"
      dest: "{{ kraken_config_dir }}/tls-tracker/client.passphrase"
  kraken_build_index:
    server_crt:
      src: "{{ kraken_repo_root }}/test/tls/ca/server.crt"
      dest: "{{ kraken_config_dir }}/tls-build-index/server.crt"
    server_key:
      src: "{{ kraken_repo_root }}/test/tls/ca/server.key"
      dest: "{{ kraken_config_dir }}/tls-build-index/server.key"
    server_passphrase:
      src: "{{ kraken_repo_root }}/test/tls/ca/passphrase"
      dest: "{{ kraken_config_dir }}/tls-build-index/server.passphrase"
    client_crt:
      src: "{{ kraken_repo_root }}/test/tls/client/client.crt"
      dest: "{{ kraken_config_dir }}/tls-build-index/client.crt"
    client_key:
      src: "{{ kraken_repo_root }}/test/tls/client/client.key"
      dest: "{{ kraken_config_dir }}/tls-build-index/client.key"
    client_passphrase:
      src: "{{ kraken_repo_root }}/test/tls/client/passphrase"
      dest: "{{ kraken_config_dir }}/tls-build-index/client.passphrase"

