---
# kraken global variables
kraken_repo_root: "{{ playbook_dir }}/../.."
kraken_binaries_dir: "{{ kraken_repo_root }}/bin"
systemd_dir: /etc/systemd/system
kraken_herd_hosts: "{{ groups['herd'] | map('extract', hostvars, ['ansible_fqdn']) | list }}"
kraken_config_dir: /etc/kraken
kraken_binary_dir: /usr/local/bin
kraken_socket_dir: /run/kraken
kraken_group: kraken

# kraken-agent
kraken_agent_binary_src: "{{ kraken_binaries_dir }}/agent"
kraken_agent_binary: "{{ kraken_binary_dir }}/kraken-agent"
kraken_agent_service: "{{ systemd_dir }}/kraken-agent.service"
kraken_agent_registry_port: 32001
kraken_agent_peer_port: 32002
kraken_agent_server_port: 32003
kraken_agent_user: kraken-agent
kraken_agent_socket_dir: "{{ kraken_socket_dir }}/agent"
kraken_agent_socket: "{{ kraken_agent_socket_dir }}/kraken-agent.sock"
kraken_agent_tls_folder: "{{ kraken_config_dir }}/tls"
kraken_agent_server_crt: "{{ kraken_agent_tls_folder }}/server.crt"
kraken_agent_server_key: "{{ kraken_agent_tls_folder }}/server.key"
kraken_agent_server_passphrase: "{{ kraken_agent_tls_folder }}/server.passphrase"
kraken_agent_client_crt: "{{ kraken_agent_tls_folder }}/client.crt"
kraken_agent_client_key: "{{ kraken_agent_tls_folder }}/client.key"
kraken_agent_client_passphrase: "{{ kraken_agent_tls_folder }}/client.passphrase"
kraken_agent_log_folder: /var/log/kraken/kraken-agent
kraken_agent_cache_folder: /var/cache/kraken/kraken-agent
kraken_agent_nginx_folders:
  - /tmp/nginx/
  - /var/lib/nginx/
  - /var/log/nginx/
  - /var/run/nginx/
kraken_agent_folders:
  - "{{ kraken_config_dir }}/nginx/config"
  - "{{ kraken_agent_tls_folder }}"
  - "{{ kraken_agent_log_folder }}"
  - "{{ kraken_agent_cache_folder }}/nginx"
  - "{{ kraken_agent_cache_folder }}/cache"
  - "{{ kraken_agent_cache_folder }}/download"

# redis for redis
redis_binaries_src: "{{ kraken_repo_root }}/redis/bin/"
redis_binaries: "{{ kraken_binary_dir }}"
redis_service: "{{ systemd_dir }}/redis.service"
redis_port: 6379
redis_user: redis
redis_cache_folder: /var/cache/kraken/redis
redis_folders:
  - "{{ kraken_config_dir }}"
  - "{{ redis_cache_folder }}"

# kraken-origin
kraken_origin_binary_src: "{{ kraken_binaries_dir }}/origin"
kraken_origin_binary: "{{ kraken_binary_dir }}/kraken-origin"
kraken_origin_service: "{{ systemd_dir }}/kraken-origin.service"
kraken_origin_registry_port: 32001
kraken_origin_peer_port: 32002
kraken_origin_server_port: 32003
kraken_origin_user: kraken-origin
kraken_origin_socket_dir: "{{ kraken_socket_dir }}/origin"
kraken_origin_socket: "{{ kraken_origin_socket_dir }}/kraken-origin.sock"
kraken_origin_tls_folder: "{{ kraken_config_dir }}/tls-origin"
kraken_origin_server_crt: "{{ kraken_origin_tls_folder }}/server.crt"
kraken_origin_server_key: "{{ kraken_origin_tls_folder }}/server.key"
kraken_origin_server_passphrase: "{{ kraken_origin_tls_folder }}/server.passphrase"
kraken_origin_client_crt: "{{ kraken_origin_tls_folder }}/client.crt"
kraken_origin_client_key: "{{ kraken_origin_tls_folder }}/client.key"
kraken_origin_client_passphrase: "{{ kraken_origin_tls_folder }}/client.passphrase"
kraken_origin_log_folder: /var/log/kraken/kraken-origin
kraken_origin_cache_folder: /var/cache/kraken/kraken-origin
kraken_origin_nginx_folders:
  - /tmp/nginx/
  - /var/lib/nginx/
  - /var/log/nginx/
  - /var/run/nginx/
kraken_origin_folders:
  - "{{ kraken_config_dir }}/nginx/config"
  - "{{ kraken_origin_tls_folder }}"
  - "{{ kraken_origin_log_folder }}"
  - "{{ kraken_origin_cache_folder }}/nginx"
  - "{{ kraken_origin_cache_folder }}/cache"
  - "{{ kraken_origin_cache_folder }}/download"

# kraken-tracker
kraken_tracker_binary_src: "{{ kraken_binaries_dir }}/tracker"
kraken_tracker_binary: "{{ kraken_binary_dir }}/kraken-tracker"
kraken_tracker_service: "{{ systemd_dir }}/kraken-tracker.service"
kraken_tracker_port: 32004
kraken_tracker_user: kraken-tracker
kraken_tracker_socket_dir: "{{ kraken_socket_dir }}/tracker"
kraken_tracker_socket: "{{ kraken_tracker_socket_dir }}/kraken-tracker.sock"
kraken_tracker_tls_folder: "{{ kraken_config_dir }}/tls-tracker"
kraken_tracker_server_crt: "{{ kraken_tracker_tls_folder }}/server.crt"
kraken_tracker_server_key: "{{ kraken_tracker_tls_folder }}/server.key"
kraken_tracker_server_passphrase: "{{ kraken_tracker_tls_folder }}/server.passphrase"
kraken_tracker_client_crt: "{{ kraken_tracker_tls_folder }}/client.crt"
kraken_tracker_client_key: "{{ kraken_tracker_tls_folder }}/client.key"
kraken_tracker_client_passphrase: "{{ kraken_tracker_tls_folder }}/client.passphrase"
kraken_tracker_log_folder: /var/log/kraken/kraken-tracker
kraken_tracker_cache_folder: /var/cache/kraken/kraken-tracker
kraken_tracker_nginx_folders:
  - /tmp/nginx/
  - /var/lib/nginx/
  - /var/log/nginx/
  - /var/run/nginx/
kraken_tracker_folders:
  - "{{ kraken_config_dir }}/nginx/config"
  - "{{ kraken_tracker_tls_folder }}"
  - "{{ kraken_tracker_log_folder }}"
  - "{{ kraken_tracker_cache_folder }}/nginx"
  - "{{ kraken_tracker_cache_folder }}/cache"
  - "{{ kraken_tracker_cache_folder }}/download"

# kraken-build-index
kraken_build_index_port: 32005


# Kraken services configuration dictionaries:
binary_files:
  redis:
    redis_binaries:
      src: "{{ redis_binaries_src }}/"
      dest: "{{ kraken_binary_dir }}"
  kraken_agent:
    kraken_agent_binary:
      src: "{{ kraken_agent_binary_src }}/"
      dest: "{{ kraken_agent_binary }}"
  kraken_origin:
    kraken_origin_binary:
      src: "{{ kraken_origin_binary_src }}/"
      dest: "{{ kraken_origin_binary }}"
  kraken_tracker:
    kraken_tracker_binary:
      src: "{{ kraken_tracker_binary_src }}/"
      dest: "{{ kraken_tracker_binary }}"

config_files:
  redis:
    config:
      src: redis.conf.j2
      dest: "{{ kraken_config_dir }}/redis.conf"
    systemd:
      src: redis.service.j2
      dest: "{{ redis_service }}"
  kraken_agent_templates:
    base:
      src: kraken-agent_base.yaml.j2
      dest: "{{ kraken_config_dir }}/base.yaml"
    config:
      src: kraken-agent.yaml.j2
      dest: "{{ kraken_config_dir }}/kraken-agent.yaml"
    systemd:
      src: kraken-agent.service.j2
      dest: "{{ kraken_agent_service }}"
  kraken_agent_files:
    nginx_config:
      src: "{{ kraken_repo_root }}/nginx/config/"
      dest: "{{ kraken_config_dir }}/nginx/config/"
  kraken_origin_templates:
    base:
      src: kraken-origin_base.yaml.j2
      dest: "{{ kraken_config_dir }}/base.yaml"
    config:
      src: kraken-origin.yaml.j2
      dest: "{{ kraken_config_dir }}/kraken-origin.yaml"
    systemd:
      src: kraken-origin.service.j2
      dest: "{{ kraken_origin_service }}"
  kraken_origin_files:
    nginx_config:
      src: "{{ kraken_repo_root }}/nginx/config/"
      dest: "{{ kraken_config_dir }}/nginx/config/"
  kraken_tracker_templates:
    base:
      src: kraken-tracker_base.yaml.j2
      dest: "{{ kraken_config_dir }}/base.yaml"
    config:
      src: kraken-tracker.yaml.j2
      dest: "{{ kraken_config_dir }}/kraken-tracker.yaml"
    systemd:
      src: kraken-tracker.service.j2
      dest: "{{ kraken_tracker_service }}"
  kraken_tracker_files:
    nginx_config:
      src: "{{ kraken_repo_root }}/nginx/config/"
      dest: "{{ kraken_config_dir }}/nginx/config/"

tls_certificates:
  kraken_agent:
    server_crt:
      src: "{{ kraken_repo_root }}/test/tls/ca/server.crt"
      dest: "{{ kraken_agent_server_crt }}"
    server_key:
      src: "{{ kraken_repo_root }}/test/tls/ca/server.key"
      dest: "{{ kraken_agent_server_key }}"
    server_passphrase:
      src: "{{ kraken_repo_root }}/test/tls/ca/passphrase"
      dest: "{{ kraken_agent_server_passphrase }}"
    client_crt:
      src: "{{ kraken_repo_root }}/test/tls/client/client.crt"
      dest: "{{ kraken_agent_client_crt }}"
    client_key:
      src: "{{ kraken_repo_root }}/test/tls/client/client.key"
      dest: "{{ kraken_agent_client_key }}"
    client_passphrase:
      src: "{{ kraken_repo_root }}/test/tls/client/passphrase"
      dest: "{{ kraken_agent_client_passphrase }}"
  kraken_origin:
    server_crt:
      src: "{{ kraken_repo_root }}/test/tls/ca/server.crt"
      dest: "{{ kraken_origin_server_crt }}"
    server_key:
      src: "{{ kraken_repo_root }}/test/tls/ca/server.key"
      dest: "{{ kraken_origin_server_key }}"
    server_passphrase:
      src: "{{ kraken_repo_root }}/test/tls/ca/passphrase"
      dest: "{{ kraken_origin_server_passphrase }}"
    client_crt:
      src: "{{ kraken_repo_root }}/test/tls/client/client.crt"
      dest: "{{ kraken_origin_client_crt }}"
    client_key:
      src: "{{ kraken_repo_root }}/test/tls/client/client.key"
      dest: "{{ kraken_origin_client_key }}"
    client_passphrase:
      src: "{{ kraken_repo_root }}/test/tls/client/passphrase"
      dest: "{{ kraken_origin_client_passphrase }}"
  kraken_tracker:
    server_crt:
      src: "{{ kraken_repo_root }}/test/tls/ca/server.crt"
      dest: "{{ kraken_tracker_server_crt }}"
    server_key:
      src: "{{ kraken_repo_root }}/test/tls/ca/server.key"
      dest: "{{ kraken_tracker_server_key }}"
    server_passphrase:
      src: "{{ kraken_repo_root }}/test/tls/ca/passphrase"
      dest: "{{ kraken_tracker_server_passphrase }}"
    client_crt:
      src: "{{ kraken_repo_root }}/test/tls/client/client.crt"
      dest: "{{ kraken_tracker_client_crt }}"
    client_key:
      src: "{{ kraken_repo_root }}/test/tls/client/client.key"
      dest: "{{ kraken_tracker_client_key }}"
    client_passphrase:
      src: "{{ kraken_repo_root }}/test/tls/client/passphrase"
      dest: "{{ kraken_tracker_client_passphrase }}"